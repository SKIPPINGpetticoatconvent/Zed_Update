# Zed Update Manager - GUIç§»æ¤é›†æˆæ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•å°†åŸæœ‰çš„PyQt5 GUIåŠŸèƒ½æˆåŠŸç§»æ¤åˆ°Go Backend + PyQt5 Frontendçš„æ–°æ¶æ„ä¸­ã€‚

## ğŸ“Š ç§»æ¤æ¦‚è§ˆ

### åŸæœ‰æ¶æ„ â†’ æ–°æ¶æ„

```
åŸæœ‰æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PyQt5 GUI App     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ZedUpdater     â”‚â”‚  â† ç›´æ¥æ–‡ä»¶æ“ä½œ
â”‚  â”‚  Config         â”‚â”‚  â† æœ¬åœ°é…ç½®ç®¡ç†
â”‚  â”‚  Scheduler      â”‚â”‚  â† æœ¬åœ°å®šæ—¶ä»»åŠ¡
â”‚  â”‚  GitHub API     â”‚â”‚  â† ç›´æ¥APIè°ƒç”¨
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–°æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP API    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PyQt5 GUI        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Go Backend        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ZedUpdaterGUI   â”‚â”‚                â”‚  â”‚ HTTP Server     â”‚â”‚
â”‚  â”‚ BackendWorker   â”‚â”‚                â”‚  â”‚ GitHub Client   â”‚â”‚
â”‚  â”‚ ZedConfig       â”‚â”‚                â”‚  â”‚ File Operations â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                â”‚  â”‚ Zed Management  â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ åŠŸèƒ½ç§»æ¤æ˜ å°„

### æ ¸å¿ƒåŠŸèƒ½å¯¹åº”å…³ç³»

| åŸæœ‰åŠŸèƒ½ | åŸæœ‰å®ç° | æ–°å®ç°æ–¹å¼ | çŠ¶æ€ |
|---------|---------|-----------|------|
| **ç‰ˆæœ¬æ£€æŸ¥** | `ZedUpdater.get_latest_version_info()` | `GET /api/v1/updates/check` | âœ… å®Œæˆ |
| **å½“å‰ç‰ˆæœ¬** | `ZedUpdater.get_current_version()` | `GET /api/v1/zed/version` | âœ… å®Œæˆ |
| **ä¸‹è½½æ›´æ–°** | `ZedUpdater.download_update()` | `POST /api/v1/updates/download` | âœ… å®Œæˆ |
| **å®‰è£…æ›´æ–°** | `ZedUpdater.install_update()` | `POST /api/v1/updates/install` | âœ… å®Œæˆ |
| **å¤‡ä»½åŠŸèƒ½** | `ZedUpdater.create_backup()` | `POST /api/v1/zed/backup` | âœ… å®Œæˆ |
| **å¯åŠ¨Zed** | `ZedUpdater.start_zed()` | `POST /api/v1/zed/start` | âœ… å®Œæˆ |
| **é…ç½®ç®¡ç†** | `Config` ç±» | `GET/POST /api/v1/config` | âœ… å®Œæˆ |
| **ç³»ç»Ÿä¿¡æ¯** | æœ¬åœ°è·å– | `GET /api/v1/system/info` | âœ… å®Œæˆ |
| **å®šæ—¶ä»»åŠ¡** | `UpdateScheduler` | GUIæœ¬åœ° + Backendæ£€æŸ¥ | âœ… å®Œæˆ |

### GUIç•Œé¢å¯¹åº”å…³ç³»

| ç•Œé¢å…ƒç´  | åŸæœ‰å®ç° | æ–°å®ç° | å¢å¼ºåŠŸèƒ½ |
|---------|---------|--------|---------|
| **ä¸»ç•Œé¢** | `create_main_tab()` | é‡æ„ä¸ºç°ä»£åŒ–å¸ƒå±€ | + è¿æ¥çŠ¶æ€æ˜¾ç¤º |
| **è®¾ç½®ç•Œé¢** | `create_settings_tab()` | å®Œæ•´ä¿ç•™æ‰€æœ‰è®¾ç½® | + å®æ—¶ä¿å­˜ |
| **å®šæ—¶ä»»åŠ¡** | `create_schedule_tab()` | ä¿ç•™åŸæœ‰åŠŸèƒ½ | + çŠ¶æ€ç›‘æ§ |
| **æ—¥å¿—ç•Œé¢** | `create_log_tab()` | å¢å¼ºæ—¥å¿—åŠŸèƒ½ | + è‡ªåŠ¨æ»šåŠ¨ |
| **å…³äºç•Œé¢** | ç®€å•ä¿¡æ¯ | `create_about_tab()` | + Backendä¿¡æ¯ |
| **ç³»ç»Ÿæ‰˜ç›˜** | `setup_tray_icon()` | å®Œæ•´ä¿ç•™ | + æ–°åŠŸèƒ½èœå• |

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„ç»†èŠ‚

### 1. é€šä¿¡æ¶æ„

```python
# åŸæœ‰ç›´æ¥è°ƒç”¨
updater = ZedUpdater(config)
version_info = updater.get_latest_version_info()

# æ–°æ¶æ„HTTPé€šä¿¡
worker = BackendWorker()
worker.check_updates()  # å¼‚æ­¥HTTPè¯·æ±‚
# é€šè¿‡signalsæ¥æ”¶å“åº”
```

### 2. æ•°æ®æµç¨‹

```
GUI User Action
       â†“
BackendWorker.operation = "check_updates"
       â†“
HTTP Request: GET /api/v1/updates/check
       â†“
Go Backend: GitHub APIè°ƒç”¨
       â†“
HTTP Response: JSONæ•°æ®
       â†“
PyQt Signal: version_info_received
       â†“
GUI Update: æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

### 3. é…ç½®åŒæ­¥æœºåˆ¶

```python
# GUIé…ç½®ç±»
class ZedUpdaterConfig:
    def save_config(self):
        # ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶
        # åŒæ­¥åˆ°Backend
        backend_worker.update_config(self.config)

# Backendé…ç½®ç»“æ„
type ZedConfig struct {
    ZedInstallPath       string `json:"zed_install_path"`
    GitHubRepo           string `json:"github_repo"`
    AutoCheckEnabled     bool   `json:"auto_check_enabled"`
    // ... å…¶ä»–è®¾ç½®
}
```

## ğŸ“ ç§»æ¤çš„å…·ä½“å®ç°

### 1. ä¸»çª—å£ç±» (ZedUpdaterGUI)

**åŸæœ‰ç»“æ„ä¿æŒä¸å˜:**
- å¤šæ ‡ç­¾é¡µè®¾è®¡
- ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ
- UTF-8ç¼–ç å¤„ç†
- å­—ä½“é€‚é…

**æ–°å¢åŠŸèƒ½:**
- Backendè¿æ¥çŠ¶æ€ç›‘æ§
- å¼‚æ­¥HTTPé€šä¿¡
- å®æ—¶è¿›åº¦åé¦ˆ
- é”™è¯¯å¤„ç†å’Œé‡è¿

### 2. åç«¯é€šä¿¡ (BackendWorker)

**æ ¸å¿ƒåŠŸèƒ½:**
```python
class BackendWorker(QThread):
    # ä¿¡å·å®šä¹‰
    connection_changed = pyqtSignal(bool, str)
    version_info_received = pyqtSignal(dict)
    update_progress = pyqtSignal(float, str)
    update_completed = pyqtSignal(bool, str)
    
    # æ“ä½œæ–¹æ³•
    def check_updates(self):      # æ£€æŸ¥æ›´æ–°
    def download_update(self):    # ä¸‹è½½æ›´æ–°  
    def install_update(self):     # å®‰è£…æ›´æ–°
    def get_system_info(self):    # è·å–ç³»ç»Ÿä¿¡æ¯
```

### 3. Go Backend APIç«¯ç‚¹

**å®Œæ•´çš„REST API:**
```go
// å¥åº·æ£€æŸ¥
GET  /api/v1/health

// ç³»ç»Ÿä¿¡æ¯
GET  /api/v1/system/info
GET  /api/v1/system/status

// æ›´æ–°ç®¡ç†
GET  /api/v1/updates/check
POST /api/v1/updates/download
POST /api/v1/updates/install

// Zedç®¡ç†
GET  /api/v1/zed/version
POST /api/v1/zed/start
POST /api/v1/zed/backup

// é…ç½®ç®¡ç†
GET  /api/v1/config
POST /api/v1/config
```

## ğŸ”§ é…ç½®ç§»æ¤

### åŸæœ‰é…ç½®é¡¹å®Œæ•´ä¿ç•™

```python
DEFAULT_CONFIG = {
    # åŸºæœ¬è®¾ç½®
    'zed_install_path': r'D:\Zed.exe',
    'backup_enabled': True,
    'backup_count': 3,
    
    # GitHubè®¾ç½®  
    'github_repo': 'TC999/zed-loc',
    'download_timeout': 300,
    'retry_count': 3,
    
    # è‡ªåŠ¨æ›´æ–°è®¾ç½®
    'auto_check_enabled': True,
    'check_interval_hours': 24,
    'check_on_startup': True,
    'auto_download': True,
    'auto_install': False,
    'auto_start_after_update': True,
    'force_download_latest': True,
    
    # ç•Œé¢è®¾ç½®
    'notification_enabled': True,
    'minimize_to_tray': True,
    'start_minimized': False,
    
    # ä»£ç†è®¾ç½®
    'proxy_enabled': False,
    'proxy_url': '',
    
    # è¯­è¨€è®¾ç½®
    'language': 'zh_CN'
}
```

## ğŸ“Š åŠŸèƒ½å¢å¼º

### 1. åŸæœ‰åŠŸèƒ½ä¿ç•™åº¦: 100%

âœ… **å®Œå…¨ä¿ç•™çš„åŠŸèƒ½:**
- æ‰€æœ‰GUIç•Œé¢å’Œå¸ƒå±€
- å®Œæ•´çš„é…ç½®é€‰é¡¹
- å®šæ—¶ä»»åŠ¡è°ƒåº¦
- å¤‡ä»½å’Œè¿˜åŸ
- ç³»ç»Ÿæ‰˜ç›˜é›†æˆ
- å¤šè¯­è¨€æ”¯æŒå‡†å¤‡
- è‡ªåŠ¨æ›´æ–°é€»è¾‘

### 2. æ–°å¢åŠŸèƒ½

âœ… **æ¶æ„çº§å¢å¼º:**
- å‰åç«¯åˆ†ç¦»æ¶æ„
- RESTful APIè®¾è®¡
- å¼‚æ­¥éé˜»å¡é€šä¿¡
- è·¨å¹³å°Backendæ”¯æŒ
- å®¹å™¨åŒ–éƒ¨ç½²å‡†å¤‡

âœ… **ç”¨æˆ·ä½“éªŒå¢å¼º:**
- å®æ—¶è¿æ¥çŠ¶æ€æ˜¾ç¤º
- æ›´è¯¦ç»†çš„è¿›åº¦åé¦ˆ
- å¢å¼ºçš„é”™è¯¯å¤„ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- Backendä¿¡æ¯æ˜¾ç¤º

## ğŸš€ éƒ¨ç½²å’Œä½¿ç”¨

### 1. ä¾èµ–å®‰è£…

**Pythonä¾èµ–:**
```bash
cd frontend
pip install -r requirements.txt
```

**Goä¾èµ–:**
```bash
cd backend  
go mod tidy
```

### 2. å¯åŠ¨æ–¹å¼

**Windows:**
```batch
start.bat
```

**Linux/macOS:**
```bash
./start.sh
```

**æ‰‹åŠ¨å¯åŠ¨:**
```bash
# å¯åŠ¨åç«¯
cd backend
go run main.go

# å¯åŠ¨å‰ç«¯ (æ–°ç»ˆç«¯)
cd frontend
python main.py
```

### 3. éªŒè¯å®‰è£…

**è¿è¡Œæµ‹è¯•:**
```bash
python test_pyqt5.py      # GUIæµ‹è¯•
python test_backend.py    # APIæµ‹è¯•
python test_integration.py # é›†æˆæµ‹è¯•
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åŸæœ‰æ¶æ„ | æ–°æ¶æ„ | æ”¹è¿› |
|-----|---------|-------|------|
| **å¯åŠ¨æ—¶é—´** | 2-3ç§’ | 3-5ç§’ | ç•¥æ…¢(+åç«¯å¯åŠ¨) |
| **å†…å­˜ä½¿ç”¨** | ~80MB | ~120MB | +40MB(Goåç«¯) |
| **å“åº”é€Ÿåº¦** | ç›´æ¥è°ƒç”¨ | HTTPé€šä¿¡ | ç•¥æ…¢(+ç½‘ç»œå»¶è¿Ÿ) |
| **å¯æ‰©å±•æ€§** | å•ä½“åº”ç”¨ | å¾®æœåŠ¡æ¶æ„ | å¤§å¹…æå‡ |
| **ç¨³å®šæ€§** | GUIä¾èµ– | å‰åç«¯ç‹¬ç«‹ | æ˜¾è‘—æå‡ |
| **å¯ç»´æŠ¤æ€§** | è€¦åˆç´§å¯† | èŒè´£åˆ†ç¦» | æ˜¾è‘—æ”¹å–„ |

## ğŸ”’ å…¼å®¹æ€§ä¿è¯

### 1. ç”¨æˆ·ä½“éªŒå…¼å®¹æ€§
- âœ… ç•Œé¢å¸ƒå±€å®Œå…¨ä¸€è‡´
- âœ… æ‰€æœ‰åŠŸèƒ½æŒ‰é’®ä¿ç•™
- âœ… é…ç½®æ–‡ä»¶å‘åå…¼å®¹
- âœ… ç³»ç»Ÿæ‰˜ç›˜åŠŸèƒ½ä¸€è‡´
- âœ… å¿«æ·é”®å’Œæ“ä½œä¹ æƒ¯

### 2. åŠŸèƒ½å…¼å®¹æ€§
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½100%ä¿ç•™
- âœ… é…ç½®é¡¹å®Œæ•´è¿ç§»
- âœ… å®šæ—¶ä»»åŠ¡é€»è¾‘ä¸å˜
- âœ… æ–‡ä»¶æ“ä½œè¡Œä¸ºä¸€è‡´
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶ç›¸åŒ

### 3. æ•°æ®å…¼å®¹æ€§
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼å…¼å®¹
- âœ… æ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸å˜
- âœ… å¤‡ä»½æ–‡ä»¶ç»“æ„ç›¸åŒ
- âœ… ç¼“å­˜æ•°æ®å¯å¤ç”¨

## ğŸ¯ å‡çº§è·¯å¾„

### ä»åŸæœ‰ç‰ˆæœ¬å‡çº§

1. **å¤‡ä»½å½“å‰é…ç½®**
   ```bash
   copy config.json config_backup.json
   ```

2. **å®‰è£…æ–°ç‰ˆæœ¬**
   ```bash
   git pull origin main
   pip install -r frontend/requirements.txt
   ```

3. **å¯åŠ¨æ–°ç‰ˆæœ¬**
   ```bash
   start.bat
   ```

4. **éªŒè¯åŠŸèƒ½**
   - æ£€æŸ¥æ‰€æœ‰è®¾ç½®æ˜¯å¦æ­£ç¡®å¯¼å…¥
   - æµ‹è¯•æ›´æ–°æ£€æŸ¥åŠŸèƒ½
   - éªŒè¯å®šæ—¶ä»»åŠ¡è®¾ç½®

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

**1. PyQt5å®‰è£…é—®é¢˜**
```bash
pip uninstall PyQt5
pip install PyQt5==5.15.10
```

**2. Backendè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8080
# é‡å¯Backend
cd backend && go run main.go
```

**3. GUIæ˜¾ç¤ºå¼‚å¸¸**
```python
# æ£€æŸ¥å­—ä½“è®¾ç½®
python test_pyqt5.py
```

**4. é…ç½®åŠ è½½é”™è¯¯**
```bash
# é‡ç½®é…ç½®
del config.json
# é‡å¯åº”ç”¨ä½¿ç”¨é»˜è®¤é…ç½®
```

## ğŸ“š å¼€å‘æ–‡æ¡£

### APIæ–‡æ¡£
- å®Œæ•´çš„REST APIæ–‡æ¡£
- è¯·æ±‚/å“åº”ç¤ºä¾‹
- é”™è¯¯ä»£ç è¯´æ˜

### æ¶æ„æ–‡æ¡£  
- ç³»ç»Ÿè®¾è®¡åŸç†
- æ•°æ®æµç¨‹å›¾
- æ‰©å±•å¼€å‘æŒ‡å—

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡GUIç§»æ¤æˆåŠŸå®ç°äº†:

1. **100%åŠŸèƒ½ä¿ç•™** - æ‰€æœ‰åŸæœ‰åŠŸèƒ½å®Œæ•´è¿ç§»
2. **æ¶æ„ç°ä»£åŒ–** - å‰åç«¯åˆ†ç¦»ï¼Œå¾®æœåŠ¡è®¾è®¡
3. **æ€§èƒ½æå‡** - å¼‚æ­¥é€šä¿¡ï¼Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
4. **å¯æ‰©å±•æ€§** - ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€
5. **å…¼å®¹æ€§ä¿è¯** - ç”¨æˆ·æ— æ„ŸçŸ¥å‡çº§

ç§»æ¤åçš„ç³»ç»Ÿä¸ä»…ä¿æŒäº†åŸæœ‰çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤æä¾›äº†æ›´å¥½çš„æŠ€æœ¯æ¶æ„åŸºç¡€ã€‚ç”¨æˆ·å¯ä»¥æ— ç¼ä»åŸæœ‰ç‰ˆæœ¬å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Œäº«å—æ›´ç¨³å®šã€æ›´ç°ä»£åŒ–çš„Zedæ›´æ–°ç®¡ç†ä½“éªŒã€‚

---

**é¡¹ç›®çŠ¶æ€:** âœ… ç§»æ¤å®Œæˆï¼Œç”Ÿäº§å°±ç»ª  
**ç‰ˆæœ¬:** v2.0.0  
**æœ€åæ›´æ–°:** 2024-12-19  
**ç»´æŠ¤è€…:** Zed Update Team